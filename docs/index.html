<!DOCTYPE html>
<html lang="fr" class="translated-ltr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>API Client / Serveur | Wild Code School</title>
        <link rel="stylesheet" href="assets/css/style.css" />
        <link rel="stylesheet" href="assets/css/syntax_monokai.css" />

        <link rel="stylesheet" href="assets/css/tic-tac.css" />
        <script src="assets/js/wrappTicTac.js" type="module"></script>
    </head>
    <body class="">
        <header>
            <div>
                <h1>API Client / Serveur</h1>

                <p>Exposer et consommer une API dans un projet PHP MVC</p>
            </div>
        </header>

        <main id="main">
            <img
                class="main-image"
                src="assets/img/biznutz.png"
                alt="API Client / Serveur"
            />

            <div class="widget-clone">
                <label for="input-clone"
                    ><i class="bi bi-code-slash"></i
                    ><font style="vertical-align: inherit"
                        ><font style="vertical-align: inherit">Code</font></font
                    ></label
                >
                <div class="input-group">
                    <input
                        type="text"
                        readonly=""
                        value="git clone https://github.com/PPaillard/workshop-php-api-simple-mvc"
                        id="input-clone"
                    />
                    <button
                        id="copy-button"
                        class="copy-button"
                        aria-label="Copier dans le presse-papier"
                    >
                        <span class="icon-copy">
                            <i class="bi-clipboard"></i>
                        </span>
                        <span class="icon-check"
                            ><font style="vertical-align: inherit"
                                ><font style="vertical-align: inherit">
                                    Copi√©
                                </font></font
                            ><i class="bi-check-lg"></i>
                        </span>
                    </button>
                </div>
                <div class="text-end">
                    <a
                        href="https://github.com/PPaillard/workshop-php-api-simple-mvc"
                        target="_blank"
                    >
                        <small
                            ><font style="vertical-align: inherit"
                                ><font style="vertical-align: inherit"
                                    >https://github.com/PPaillard/workshop-php-api-simple-mvc</font
                                ></font
                            ><i class="bi bi-box-arrow-up-right"></i
                        ></small>
                    </a>
                </div>
            </div>

            <div class="wrapper-tic-tac">
                <section class="no-background">
                    <h1 id="tic--tac--biznutz">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >TIC &amp; TAC : BIZNUTZ</font
                            ></font
                        >
                    </h1>
                    <p>
                        Tic &amp; Tac ont bien r√©fl√©chi derni√®rement et ont
                        d√©cid√© de se lancer ensemble dans une nouvelle aventure
                        : <strong>BizNutz</strong>.
                    </p>
                    <p>
                        Apr√®s une cueillette fructueuse cette ann√©e, ils ont
                        d√©cid√© d‚Äôouvrir un commerce en ligne pour revendre leur
                        stock en trop de noisettes aux locataires des for√™ts
                        voisines.
                    </p>
                    <p>
                        Pour mener √† bien leur projet, ils lancent une
                        plateforme de e-commerce et se r√©partissent les t√¢ches.
                        <strong>Tac</strong> s‚Äôoccupe de l‚Äôapplication de
                        gestion du stock et <strong>Tic</strong> s‚Äôoccupe, quant
                        √† lui, du site marchand.
                    </p>
                    <p class="text-center">
                        <img
                            src="assets/img/1943-tic-tac-17.jpg"
                            alt="tic tac"
                        />
                    </p>
                    <p>
                        En √©quipe de 2 d√©veloppeurs, suivez les consignes en
                        choisissant chacun votre r√¥le !<br />
                        Colonne de gauche, Tic et colonne de droite Tac.
                    </p>
                    <p class="alert-info">
                        Clonez ce d√©p√¥t gr√¢ce au lien donn√© ci-dessus ‚¨Ü
                        <a href="#input-clone"
                            ><i class="bi bi-code-slash"></i
                            ><font style="vertical-align: inherit"
                                ><font style="vertical-align: inherit"
                                    >&nbsp;Code</font
                                ></font
                            ></a
                        ><font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit">
                                .</font
                            ></font
                        >
                    </p>
                    <p>Effectuez ensuite les t√¢ches suivantes :</p>
                    <ul>
                        <li>
                            <code class="language-plaintext highlighter-rouge"
                                >cd workshop-php-api-simple-mvc</code
                            >
                        </li>
                        <li>
                            <code class="language-plaintext highlighter-rouge"
                                >composer install</code
                            >
                        </li>
                        <li>
                            Cr√©er le fichier <strong>db.php</strong> √† partir du
                            fichier <strong>db.php.dist</strong> avec les
                            identifiants de connexion pour PDO et la base de
                            donn√©es <strong>workshop_api_biznutz</strong>
                        </li>
                    </ul>
                    <p class="alert-warning">
                        Important : TAC devra bien entrer les informations de sa
                        base de donn√©es dans ce fichier mais TIC pourra laisser
                        les informations telles quelles.
                    </p>
                    <ul>
                        <li>
                            Lancer la commande
                            <code class="language-plaintext highlighter-rouge"
                                >php migration.php</code
                            >
                        </li>
                        <li>
                            Enfin, d√©marrer le serveur PHP
                            <div class="language-bash highlighter-rouge">
                                <div class="highlight">
                                    <pre
                                        class="highlight"
                                    ><code>php <span class="nt">-S</span> localhost:8000 <span class="nt">-t</span> public
</code></pre>
                                </div>
                            </div>
                        </li>
                    </ul>
                </section>

                <section class="tic">
                    <h2 id="-tic">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >üëÄ Tic</font
                            ></font
                        >
                    </h2>
                    <p>
                        Sois attentif √† ce que fait <strong>Tac</strong> et
                        aide-le si besoin.
                    </p>
                </section>

                <section class="tac">
                    <h2 id="tac">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >Tac</font
                            ></font
                        >
                    </h2>
                    <h3 id="cr√©ation-de-la-table-nut-en-base-de-donn√©es">
                        Cr√©ation de la table <em>nut</em> en base de donn√©es
                    </h3>
                    <p>
                        Tac enregistre l‚Äô√©tat des stocks dans sa base de donn√©es
                        <strong>workshop_api_biznutz</strong>.
                    </p>
                    <p class="alert-info">
                        Pour effectuer les deux points suivants, tu peux
                        utiliser ton terminal ou √©crire les requ√™tes dans le
                        fichier <strong>database.sql</strong>. Il suffira alors
                        de lancer la commande
                        <code class="language-plaintext highlighter-rouge"
                            >php migration.php</code
                        >
                        pour les ex√©cuter.
                    </p>
                    <ol>
                        <li>
                            Cr√©e une table <strong>nut</strong> avec les champs
                            suivants :
                            <ul>
                                <li>
                                    <strong
                                        ><font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >id</font
                                            ></font
                                        ></strong
                                    ><font style="vertical-align: inherit"
                                        ><font style="vertical-align: inherit">
                                            : INT AUTO_INCREMENT CL√â
                                            PRIMAIRE</font
                                        ></font
                                    >
                                </li>
                                <li>
                                    <strong
                                        ><font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >nom</font
                                            ></font
                                        ></strong
                                    ><font style="vertical-align: inherit"
                                        ><font style="vertical-align: inherit">
                                            : VARCHAR(64) NON NULL</font
                                        ></font
                                    >
                                </li>
                                <li>
                                    <strong
                                        ><font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >stock</font
                                            ></font
                                        ></strong
                                    ><font style="vertical-align: inherit"
                                        ><font style="vertical-align: inherit">
                                            : INT NON NULL PAR D√âFAUT 0</font
                                        ></font
                                    >
                                </li>
                            </ul>
                        </li>
                        <li>
                            Remplis cette table
                            <strong><em>nut</em></strong> avec quelques donn√©es,
                            par exemple :
                        </li>
                    </ol>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>
                                        <font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >nom</font
                                            ></font
                                        >
                                    </th>
                                    <th style="text-align: center">
                                        <font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >action</font
                                            ></font
                                        >
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>noix</td>
                                    <td style="text-align: center">
                                        <font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >150</font
                                            ></font
                                        >
                                    </td>
                                </tr>
                                <tr>
                                    <td>noisette</td>
                                    <td style="text-align: center">
                                        <font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >180</font
                                            ></font
                                        >
                                    </td>
                                </tr>
                                <tr>
                                    <td>pistache</td>
                                    <td style="text-align: center">
                                        <font style="vertical-align: inherit"
                                            ><font
                                                style="vertical-align: inherit"
                                                >100</font
                                            ></font
                                        >
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 id="cr√©ation-du-manager">Cr√©ation du Manager</h3>
                    <p>
                        Tac a besoin de r√©cup√©rer la liste des stocks depuis la
                        base afin de, plus tard, pouvoir l‚Äôenvoyer √† Tic.
                    </p>
                    <ol>
                        <li>
                            Cr√©e un nouveau manager <em>NutManager</em> qui sera
                            li√© √† ta table <em>nut</em>.
                        </li>
                        <li>
                            Pense √† √©tendre la classe
                            <em>AbstractManager</em> et √† ajouter la constante
                            <strong>TABLE</strong>.
                        </li>
                    </ol>
                </section>

                <section class="tic">
                    <h2 id="tic">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >Tic</font
                            ></font
                        >
                    </h2>
                    <h3 id="aide-tac-√†-cr√©er-son-controller">
                        Aide Tac √† cr√©er son controller
                    </h3>
                    <p>
                        Pour que tu puisses r√©cup√©rer la liste des stocks, il va
                        falloir que l‚ÄôAPI de <strong>Tac</strong> te retourne
                        ces donn√©es.
                    </p>
                    <p>
                        √Ä la diff√©rence d‚Äôune r√©ponse HTTP standard, celle-ci ne
                        retournera pas du code HTML, mais un objet JSON converti
                        en <em>string</em> qui contiendra les stocks.<br />
                        Jette un oeil √† la fonction
                        <a
                            href="https://www.php.net/manual/en/function.json-encode.php"
                            >json_encode</a
                        >
                        et aide <strong>Tac</strong> √† r√©aliser cette t√¢che.
                    </p>
                </section>

                <section class="tac">
                    <h2 id="tac-1">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >Tac</font
                            ></font
                        >
                    </h2>
                    <h3 id="pr√©pare-le-simple-mvc-en-tant-quapi">
                        Pr√©pare le simple-MVC en tant qu‚ÄôAPI
                    </h3>
                    <p>
                        Pour indiquer lors de la communication client / serveur
                        le type de contenu qui sera envoy√©, il faut ajouter des
                        informations dans les headers.<br />
                        Comme l‚Äôapplication de TAC sera une API, il faut
                        indiquer que ce sera du JSON qui transitera et autoriser
                        les requ√™tes HTTP vers l‚ÄôAPI.<br />
                        Afin de ne pas modifier le Framework SimpleMVC
                        directement, tu vas cr√©er un nouveau Contr√¥leur abstrait
                        dans un fichier
                        <em>src/Controller/AbstractAPIController.php</em>.<br />
                        Ajoute le code suivant dans ton fichier :
                    </p>
                    <div class="language-php highlighter-rouge">
                        <div class="highlight">
                            <pre
                                class="highlight"
                            ><code><span class="cp">&lt;?php</span><font></font>
<font></font>
<span class="kn">namespace</span> <span class="nn">App\Controller</span><span class="p">;</span><font></font>
<font></font>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">AbstractAPIController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin: \*"</span><span class="p">);</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Methods: POST,GET,PUT,DELETE, OPTIONS"</span><span class="p">);</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers: Authorization, Origin, X-Requested-With, Content-Type, Accept"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
                        </div>
                    </div>
                    <h3 id="cr√©ation-du-controller">Cr√©ation du Controller</h3>
                    <ol>
                        <li>
                            Cr√©e un nouveau controller <em>NutController</em>.
                        </li>
                        <li>
                            Plut√¥t qu‚Äô√©tendre <em>AbstractController</em>, ce
                            contr√¥leur devra √©tendre
                            <em>AbstractAPIController</em>.
                        </li>
                        <li>
                            Cr√©e une m√©thode <em>index()</em> dans ce
                            <em>NutController</em>.
                        </li>
                        <li>
                            Dans cette m√©thode, r√©cup√®re la liste des stocks √†
                            l‚Äôaide de ton <em>NutManager</em> et fait en sorte
                            qu‚Äôelle retourne cette liste sous forme de string
                            contenant du JSON. (<strong>Tic</strong> va t‚Äôaider
                            √† r√©aliser cette partie).
                        </li>
                        <li>
                            Ajoute au fichier <strong>src/routes.php</strong> la
                            route
                            <code class="language-plaintext highlighter-rouge"
                                >nuts</code
                            >
                            qui fera r√©f√©rence √† ce <em>NutController</em> et sa
                            m√©thode <em>index()</em>.
                        </li>
                        <li>
                            Teste ton code en te rendant √† l‚ÄôURL
                            <a href="http://localhost:8000/nuts"
                                >http://localhost:8000/nuts</a
                            >.<br />
                            Tu devrais alors voir du texte correspondant √† du
                            JSON avec tes donn√©es de stocks √† l‚Äôint√©rieur.<br />
                            Par exemple :
                            <div class="language-json highlighter-rouge">
                                <div class="highlight">
                                    <pre
                                        class="highlight"
                                    ><code><span class="p">[{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"noix"</span><span class="p">,</span><span class="nl">"stock"</span><span class="p">:</span><span class="s2">"150"</span><span class="p">},{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"2"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"noisette"</span><span class="p">,</span><span class="nl">"stock"</span><span class="p">:</span><span class="s2">"180"</span><span class="p">},{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"3"</span><span class="p">,</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"pistache"</span><span class="p">,</span><span class="nl">"stock"</span><span class="p">:</span><span class="s2">"100"</span><span class="p">}]</span><span class="w">
</span></code></pre>
                                </div>
                            </div>
                            <p>
                                Selon ton navigateur, le json peut m√™me √™tre
                                joliement mis en forme pour plus de lisibilit√©.
                            </p>
                        </li>
                    </ol>
                </section>

                <section class="no-background">
                    <h1 id="tic--tac">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >Tic et Tac</font
                            ></font
                        >
                    </h1>
                    <p>
                        Pour continuer, il faut maintenant que le serveur de Tac
                        soit accessible depuis un autre ordinateur.<br />
                        Il est possible de le faire en √©tant sur le m√™me r√©seau
                        wifi et en indiquant l‚Äôadresse ip locale en lan√ßant le
                        serveur. Deux possibilit√©s s‚Äôoffrent √† vous.
                    </p>
                    <h3 id="vous-√™tes-sur-le-m√™me-r√©seau-wifi">
                        Vous √™tes sur le m√™me r√©seau WIFI
                    </h3>
                    <p>
                        Au d√©marrage du serveur PHP, Tac peut indiquer
                        <code class="language-plaintext highlighter-rouge"
                            >0.0.0.0</code
                        >
                        √† la place de
                        <code class="language-plaintext highlighter-rouge"
                            >localhost</code
                        >. La commande compl√®te devient ainsi :
                    </p>
                    <div class="language-bash highlighter-rouge">
                        <div class="highlight">
                            <pre
                                class="highlight"
                            ><code>php <span class="nt">-S</span> 0.0.0.0:8000 <span class="nt">-t</span> public
</code></pre>
                        </div>
                    </div>
                    <p>
                        Cela a pour effet d‚Äôouvrir la connexion au serveur aux
                        autres utilisateurs qui se trouvent sur le m√™me r√©seau
                        et gr√¢ce √† l‚ÄôIP locale de Tac sur ce m√™me r√©seau.<br />
                        Pour conna√Ætre cette adresse IP, Tac doit se rendre dans
                        les param√®tres r√©seaux de son OS. Elle ressemble tr√®s
                        souvent √† une suite de nombre et de chiffres s√©par√©s par
                        des points comme ceci : <strong>192.168.0.11</strong>.
                        Cette adresse IP est d‚Äôordinaire attribu√©e
                        automatiquement par le router.<br />
                        Il suffit ensuite de se rendre avec le navigateur √†
                        l‚Äôadresse
                        <a href="http://192.168.0.11:8000/"
                            >http://192.168.0.11:8000</a
                        >
                        pour se connecter au <em>localhost</em> de l‚Äôutilisateur
                        distant.
                    </p>
                    <h3 id="vous-n√™tes-pas-sur-le-m√™me-r√©seau">
                        Vous n‚Äô√™tes pas sur le m√™me r√©seau
                    </h3>
                    <p>
                        Il existe des solutions en ligne permettant de cr√©er des
                        tunnels de connexion vers le port d‚Äôune machine et au
                        travers de DNS. C‚Äôest le cas de
                        <a href="https://ngrok.com/">Ngrok</a>,
                        <a href="https://tunnelto.dev/">Tunnelto</a> ou encore
                        <a href="http://localhost.run/">Localhost.run</a>. Nous
                        utiliserons ce dernier qui est tr√®s facile √† prendre en
                        main et ne n√©cessite aucune configuration particuli√®re
                        dans une utilisation limit√©e. Pour ouvrir les connexions
                        entrantes sur le port 8000 de ta machine, lance la
                        commande suivante :
                    </p>
                    <div class="language-bash highlighter-rouge">
                        <div class="highlight">
                            <pre
                                class="highlight"
                            ><code>ssh <span class="nt">-R</span> 80:localhost:8000 nokey@localhost.run
</code></pre>
                        </div>
                    </div>
                    <p>
                        Ton terminal te donne en retour une adresse du type
                        <a href="https://f4864e45215444.lhr.life/"
                            >https://f4864e45215444.lhr.life</a
                        >. Tu n‚Äôas plus qu‚Äô√† communiquer cette adresse √† Tic. Et
                        voil√† !
                    </p>
                </section>

                <section class="tic">
                    <h2 id="acc√®de-√†-lapi-de-tac">Acc√®de √† l‚ÄôAPI de Tac</h2>
                    <p>
                        <strong>Tic</strong> peut maintenant, avec un
                        navigateur, tenter d‚Äôafficher la route
                        <strong>/nuts</strong> de <strong>Tac</strong> pour
                        v√©rifier que tout fonctionne via l‚ÄôURL
                        <code class="language-plaintext highlighter-rouge"
                            >https://xxxxxxx.lhr.life/nuts</code
                        >
                        ou
                        <code class="language-plaintext highlighter-rouge"
                            >http://xxx.xx.xx.xx./nuts</code
                        >
                        selon la m√©thode employ√©e (remplacer les
                        <code class="language-plaintext highlighter-rouge"
                            >xxx</code
                        >
                        par les valeurs pr√©c√©demment obtenues).
                    </p>
                </section>

                <section class="tac">
                    <h2 id="surveille-ton-serveur">Surveille ton serveur</h2>
                    <p>
                        <strong>Tac</strong> jette un ≈ìil √† son terminal pour
                        voir ce qui se passe sur son serveur. Il constate qu‚Äôil
                        a bien un
                        <code class="language-plaintext highlighter-rouge"
                            >[200]: GET /nuts</code
                        >.
                    </p>
                </section>

                <section class="tic">
                    <h2 id="r√©cup√©ration-des-stocks">
                        R√©cup√©ration des stocks
                    </h2>
                    <p>
                        <strong>Tic</strong> veut maintenant r√©cup√©rer la liste
                        des stocks, seulement voil√†, la base de donn√©es est chez
                        <strong>Tac</strong>. Il va donc falloir r√©cup√©rer la
                        liste en faisant appel √† la route
                        <strong>/nuts</strong> de <strong>Tac</strong>.
                    </p>
                    <ol>
                        <li>
                            Cr√©e un nouveau manager <em>StockManager</em>.<br />
                            Ce manager <strong>ne devra pas</strong> h√©riter de
                            <em>AbstractManager</em> car tu ne te connecteras
                            pas √† ta base de donn√©es. Tu n‚Äôauras donc pas besoin
                            de d√©clarer la constante TABLE.
                        </li>
                        <li>
                            Cr√©e une m√©thode <em>getAll()</em> dans ce manager.
                        </li>
                        <li>
                            <strong>Gr√¢ce aux instructions de Tac</strong>,
                            utilise la biblioth√®que <em>HttpClient</em> et sa
                            m√©thode static
                            <code class="language-plaintext highlighter-rouge"
                                >create()</code
                            >
                            et fais appel √† l‚ÄôURL de Tac (<code
                                class="language-plaintext highlighter-rouge"
                                >https://xxxxxxx.lhr.life/nuts</code
                            >
                            ou
                            <code class="language-plaintext highlighter-rouge"
                                >http://xxx.xx.xx.xx./nuts</code
                            >) pour r√©cup√©rer les stocks.
                        </li>
                        <li>
                            Ta m√©thode doit ensuite retourner la liste des
                            stocks sous forme de tableau PHP (regarde du c√¥t√© de
                            la m√©thode <em>toArray()</em> de l‚Äôobjet
                            <em>Response</em> de HttpClient dans la
                            documentation).
                        </li>
                    </ol>
                </section>

                <section class="tac">
                    <h2 id="-aide-tic-√†-r√©cup√©rer-les-stocks">
                        üëÄ Aide Tic √† r√©cup√©rer les stocks
                    </h2>
                    <p>
                        Sois attentif √† ce que fait üêø&nbsp;<strong>Tic</strong>
                        et aide-le si besoin en t‚Äôappuyant sur les informations
                        suivantes.
                    </p>
                    <p>
                        <strong>http-client</strong> est une biblioth√®que
                        permettant de faire des requ√™tes http vers une API
                        externe.<br />
                        Cette biblioth√®que est d√©velopp√©e par
                        <strong>Symfony</strong> mais comme souvent, elle peut
                        √™tre utilis√©e en standalone, c‚Äôest √† dire en dehors du
                        framework.<br />
                        Pour l‚Äôinstaller dans un projet, il suffit d‚Äôutiliser
                        composer et la commande :
                    </p>
                    <div class="language-php highlighter-rouge">
                        <div class="highlight">
                            <pre
                                class="highlight"
                            ><code><span class="n">composer</span> <span class="k">require</span> <span class="n">symfony</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">client</span>
</code></pre>
                        </div>
                    </div>
                    <p>
                        Ensuite, la
                        <a
                            href="https://symfony.com/doc/current/http_client.html#basic-usage"
                            >documentation</a
                        >
                        explique comment l‚Äôutiliser.
                    </p>
                    <p class="alert-info">
                        Dans l‚Äôexemple de code, clique bien sur l‚Äôonglet
                        <code class="language-plaintext highlighter-rouge"
                            >Standalone Use</code
                        >
                        pour voir un exemple d‚Äôutilisation en dehors de Symfony.
                    </p>
                </section>

                <section class="tic">
                    <h2 id="affichage-des-stocks">Affichage des stocks</h2>
                    <p>
                        Maintenant que tu as r√©cup√©r√© les stocks depuis
                        l‚Äôapplication de <strong>Tac</strong>, il faut les
                        afficher
                    </p>
                    <ol>
                        <li>
                            Modifie la m√©thode <em>index()</em> du
                            <em>HomeController</em> afin qu‚Äôelle r√©cup√®re les
                            stocks √† l‚Äôaide de ton <em>StockManager</em> et sa
                            m√©thode <em>getAll()</em>.
                        </li>
                        <li>
                            Passe la liste des stocks en contexte √† ta vue
                            <em>Home/index.html.twig</em>, puis affiche les sous
                            forme de tableau HTML.
                        </li>
                        <li>
                            Lance un webserver local, si ce n‚Äôest pas d√©j√† fait,
                            et v√©rifie que la liste des stocks s‚Äôaffiche
                            correctement sur
                            <a href="http://localhost:8000/"
                                >http://localhost:8000/</a
                            >
                        </li>
                    </ol>
                </section>

                <section class="tac">
                    <h2 id="-tac">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >üëÄ Tac</font
                            ></font
                        >
                    </h2>
                    <p>
                        Sois attentif √† ce que fait <strong>Tic</strong> et
                        aide-le si besoin.
                    </p>
                </section>

                <section class="no-background">
                    <h1 id="-bravo-">
                        <font style="vertical-align: inherit"
                            ><font style="vertical-align: inherit"
                                >üëè Bravo !</font
                            ></font
                        >
                    </h1>
                    <p class="text-center">
                        Vous venez de r√©aliser votre premi√®re API et savez
                        d√©sormais comment la ‚Äúconsommer‚Äù.
                    </p>
                    <p class="text-center">
                        <img src="assets/img/giphy-tic-tac.gif" alt="" />
                    </p>
                </section>

                <section class="no-background">
                    <h1 id="-bonus--aller-plus-loin">
                        üå∞ BONUS : aller plus loin‚Ä¶
                    </h1>
                    <p>
                        Tic souhaite maintenant proposer une fonctionnalit√©
                        d‚Äôachat sur son site. Lorsqu‚Äôune personne ach√®te une
                        noix il faudra donc envoyer cette information √† l‚ÄôAPI de
                        Tac pour qu‚Äôelle puisse mettre √† jour le stock en base
                        de donn√©es.
                    </p>
                </section>

                <section class="tic">
                    <h2 id="--aide-tac-√†-mettre-√†-jour-ses-stocks">
                        üëÄ Aide Tac √† mettre √† jour ses stocks
                    </h2>
                    <p>
                        Sois attentif √† ce que fait üêø Tac et aide-le si besoin.
                    </p>
                </section>

                <section class="tac">
                    <h2 id="mise-√†-jour-des-stocks">Mise √† jour des stocks</h2>
                    <p>
                        Cr√©e une m√©thode
                        <code class="language-plaintext highlighter-rouge"
                            >decrementStock(int $id)</code
                        >
                        dans ton <em>NutManager</em>. Cette m√©thode ex√©cutera
                        une requ√™te SQL qui devra d√©cr√©menter la quantit√© en
                        stock de l‚Äôitem dont l‚ÄôID est pass√© en param√®tre.
                    </p>
                    <ol>
                        <li>
                            Cr√©e une m√©thode
                            <code class="language-plaintext highlighter-rouge"
                                >buy()</code
                            >
                            dans ton <em>NutController</em>.
                        </li>
                        <li>
                            Cette m√©thode sera associ√©e √† la route
                            <strong>/nuts/buy</strong>. Ajoute cette entr√©e √† la
                            liste des routes du fichier
                            <strong>src/routes.php</strong>. C‚Äôest cette m√©thode
                            qui sera appel√©e en POST par Tic lorsqu‚Äôun
                            utilisateur d√©cidera d‚Äôacheter une noisette. V√©rifie
                            que la m√©thode HTTP est bien POST :
                            <div class="language-php highlighter-rouge">
                                <div class="highlight">
                                    <pre
                                        class="highlight"
                                    ><code><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"POST"</span><span class="p">)</span> <span class="p">{</span> 
 <span class="c1">//...</span>
<span class="p">}</span> 
</code></pre>
                                </div>
                            </div>
                            <p>
                                Puis, fais appel √† la m√©thode
                                <code
                                    class="language-plaintext highlighter-rouge"
                                    >decrementStock($id)</code
                                >
                                de ton <em>NutManager</em> pour mettre √† jour le
                                stock de l‚Äôitem dont l‚ÄôID est pass√© en
                                param√®tre.
                            </p>
                        </li>
                    </ol>
                </section>

                <section class="tic">
                    <h2 id="ajout-de-la-fonctionnalit√©-dachat">
                        Ajout de la fonctionnalit√© d‚Äôachat
                    </h2>
                    <ol>
                        <li>
                            Ajoute un bouton-lien ‚Äúacheter‚Äù sur chaque ligne de
                            ton tableau HTML qui aura pour <em>href</em>
                            <code class="language-plaintext highlighter-rouge"
                                >/buy?id={id}</code
                            >
                            (‚Äúid‚Äù correspondant √† l‚ÄôID de l‚Äôitem).
                        </li>
                        <li>
                            Si le stock est √† z√©ro, afficher ‚ÄúStock √©puis√©‚Äù au
                            lieu du bouton ‚Äúacheter‚Äù.
                        </li>
                        <li>
                            Cr√©e une m√©thode
                            <code class="language-plaintext highlighter-rouge"
                                >buy(int $id)</code
                            >
                            dans ton <em>HomeController</em> (c‚Äôest cette
                            m√©thode qui sera appel√©e au clic sur le bouton
                            ‚ÄúAcheter‚Äù.
                        </li>
                        <li>
                            Pense √† ajouter au tableau de
                            <strong>src/routes.php</strong> la route
                            <em>buy</em> faisant r√©f√©rence √† cette m√©thode.<br />
                            ‚ö†Ô∏è Attention, elle re√ßoit un param√®tre
                            <code class="language-plaintext highlighter-rouge"
                                >$id</code
                            >
                            issu d‚Äôune requ√™te
                            <code class="language-plaintext highlighter-rouge"
                                >$_GET</code
                            >.
                        </li>
                        <li>
                            Cr√©e une m√©thode
                            <code class="language-plaintext highlighter-rouge"
                                >buy(int $id)</code
                            >
                            dans ton <em>StockManager</em>.<br />
                            Gr√¢ce √† <em>HttpClient</em>, cette m√©thode devra
                            faire un
                            <code class="language-plaintext highlighter-rouge"
                                >POST</code
                            >
                            sur la route de l‚ÄôAPI de Tac :
                            <code class="language-plaintext highlighter-rouge"
                                >http://xxx.xxx.xx.xxx/nuts/buy</code
                            >
                            avec l‚Äô<code
                                class="language-plaintext highlighter-rouge"
                                >$id</code
                            >
                            en param√®tre.<br />
                            La
                            <a
                                href="https://symfony.com/doc/current/http_client.html#uploading-data"
                                >section ‚Äúenvoi de donn√©es‚Äù</a
                            >
                            de la documentation t‚Äôaidera √† comprendre comment
                            structurer le corps de la requ√™te
                            <code class="language-plaintext highlighter-rouge"
                                >POST</code
                            >.
                        </li>
                        <li>
                            Dans la m√©thode
                            <code class="language-plaintext highlighter-rouge"
                                >buy</code
                            >
                            de ton <em>HomeController</em> :
                            <ul>
                                <li>
                                    Fais appel √† la m√©thode
                                    <code
                                        class="language-plaintext highlighter-rouge"
                                        >buy</code
                                    >
                                    de ton <em>StockManager</em>.
                                </li>
                                <li>
                                    Redirige ensuite l‚Äôutilisateur sur
                                    <code
                                        class="language-plaintext highlighter-rouge"
                                        >/</code
                                    >.<br />
                                    Si Tac a bien boss√©, le stock de l‚Äôitem en
                                    question sera alors d√©cr√©ment√©.
                                </li>
                            </ul>
                        </li>
                    </ol>
                </section>

                <section class="tac">
                    <h2
                        id="-aide-tic-√†-ajouter-la-fonctionalit√©-dachat-sur-son-site"
                    >
                        üëÄ Aide Tic √† ajouter la fonctionalit√© d‚Äôachat sur son
                        site
                    </h2>
                    <p>
                        Sois attentif √† ce que fait <strong>Tic</strong> et
                        aide-le si besoin.
                    </p>
                </section>

                <section class="no-background">
                    <h1 id="√†-suivre-">√Ä suivre üå∞üå∞üå∞</h1>
                </section>
            </div>
        </main>
    </body>
</html>
